#!/usr/bin/env ruby
# Automatic builder for openMSX and openMSX-Debugger builds for Mac OSX.
# Options:
# --debug                 => Generate debug output.
# --publish               => Publish the created build
# --publish-current       => Only publish the current build and exit
# --publish-all           => Only publish all previously created builds and exit
# --tweet                 => Send a tweet via @openMSX_Builder after successfully having published a build
# --dont-update           => Don't update the SVN repository
# --report-build-failure  => If an error occurs during build, report failure via e-mail
# --version               => Return the current version of openMSX-Builder
require 'openmsx_builder'

if ARGV.include?('--version')
  puts File.read(File.expand_path(File.join(File.dirname(__FILE__),'..','VERSION')))
  exit
end

# TODO: Refactor this into OpenmsxBuilder; perhaps make @options a class variable.
log = Logger.new(STDOUT)
log.level = Logger::FATAL
log.level = Logger::ERROR if ARGV.include?('--log-errors')
log.level = Logger::WARN if ARGV.include?('--warn')
log.level = Logger::INFO if ARGV.include?('--verbose')
log.level = Logger::DEBUG if ARGV.include?('--debug')
log.info('-'*50)
log.info("Starting with openMSX")
OpenmsxBuilder.new(ARGV,:openmsx).run
log.info('-'*50)
log.info("Proceeding with openMSX-Debugger")
OpenmsxBuilder.new(ARGV,:openmsx_debugger).run
