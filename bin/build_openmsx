#!/usr/bin/env ruby
require 'openmsx_builder'

if ARGV.include?('--version')
  puts File.read(File.expand_path(File.join(File.dirname(__FILE__),'..','VERSION')))
  exit
end

# TODO: Refactor this into OpenmsxBuilder; perhaps make @options a class variable.
log = Logger.new(STDOUT)
log.level = Logger::FATAL
log.level = Logger::ERROR if ARGV.include?('--log-errors')
log.level = Logger::WARN if ARGV.include?('--warn')
log.level = Logger::INFO if ARGV.include?('--verbose')
log.level = Logger::DEBUG if ARGV.include?('--debug')
log.info('-'*50)
log.info("Starting with openMSX 64-bit Build")
OpenmsxBuilder.new(ARGV,:openmsx_x86_64).run
log.info('-'*50)
#Prevent further SVN updates so we continue building the same revision during this round
ARGV << '--dont-update'
log.info("Now proceeding with openMSX 32-bit ")
OpenmsxBuilder.new(ARGV,:openmsx_x86).run
log.info('-'*50)
log.info("Continuing with openMSX PowerPC ")
OpenmsxBuilder.new(ARGV,:openmsx_ppc).run
log.info('-'*50)
log.info("Creating a combined openMSX Universal Build")
OpenmsxBuilder.new(ARGV,:openmsx_univ).run
log.info('-'*50)
log.info("Ending with openMSX-Debugger")
OpenmsxBuilder.new(ARGV,:openmsx_debugger).run
log.info("Build process finished")
